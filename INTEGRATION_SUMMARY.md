# åœ°å›¾åˆ†ææ™ºèƒ½ä½“é›†æˆå†›äº‹åœ°å½¢å›¾å›¾ç‰‡åˆ†æå·¥å…· - å®Œæˆæ€»ç»“

## ğŸ¯ ä»»åŠ¡å®Œæˆæƒ…å†µ

âœ… **ä»»åŠ¡å·²æˆåŠŸå®Œæˆ**ï¼šåœ°å›¾åˆ†ææ™ºèƒ½ä½“ (`MapAnalysisAgent`) ç°åœ¨å¯ä»¥ä½¿ç”¨å†›äº‹åœ°å½¢å›¾å›¾ç‰‡åˆ†æå·¥å…· (`MilitaryImageMapAnalyzer`)ã€‚

## ğŸ“‹ å®Œæˆçš„å·¥ä½œ

### 1. é…ç½®æ›´æ–°
- âœ… åœ¨ `configs/military_config.toml` ä¸­ä¸º `map_analysis_agent_config` æ·»åŠ äº† `military_image_map_analyzer` å·¥å…·
- âœ… å·¥å…·é…ç½®ï¼š`tools = ["military_map_analyzer", "military_image_map_analyzer"]`

### 2. æç¤ºè¯æ¨¡æ¿å¢å¼º
- âœ… æ›´æ–°äº† `src/agent/map_analysis_agent/prompts/map_analysis_agent.yaml`
- âœ… æ·»åŠ äº†å›¾ç‰‡åœ°å½¢å›¾åˆ†æåŠŸèƒ½æè¿°
- âœ… å¢åŠ äº†åˆ†ææµç¨‹æŒ‡å¯¼
- âœ… å®Œå–„äº†è¾“å‡ºè¦æ±‚

### 3. ä»£ç ä¿®å¤
- âœ… ä¿®å¤äº† `src/agent/map_analysis_agent/map_analysis_agent.py` ä¸­çš„å¯¼å…¥é”™è¯¯
- âœ… ä¿®å¤äº† `src/tools/military_image_map_analyzer.py` ä¸­çš„æ¨¡å‹è·å–æ–¹æ³•
- âœ… ç¡®ä¿æ‰€æœ‰å·¥å…·å’Œæ™ºèƒ½ä½“æ­£ç¡®æ³¨å†Œ

### 4. æµ‹è¯•å’ŒéªŒè¯
- âœ… åˆ›å»ºäº†éªŒè¯è„šæœ¬ `examples/verify_map_analysis_config.py`
- âœ… åˆ›å»ºäº†æµ‹è¯•ç¤ºä¾‹ `examples/test_map_analysis_with_image.py`
- âœ… æ‰€æœ‰éªŒè¯æµ‹è¯•é€šè¿‡
- âœ… å®é™…è¿è¡Œæµ‹è¯•æˆåŠŸï¼Œç”Ÿæˆäº†è¯¦ç»†çš„åœ°å½¢åˆ†ææŠ¥å‘Š

### 5. æ–‡æ¡£å®Œå–„
- âœ… åˆ›å»ºäº†è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£ `docs/map_analysis_agent_image_support.md`
- âœ… åŒ…å«åŠŸèƒ½ç‰¹æ€§ã€é…ç½®è¯´æ˜ã€ä½¿ç”¨ç¤ºä¾‹ç­‰

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### å·¥å…·æ³¨å†ŒçŠ¶æ€
```
å·²æ³¨å†Œçš„å·¥å…·:
- deep_analyzer
- deep_researcher  
- python_interpreter
- auto_browser_use
- planning
- military_map_analyzer
- military_image_map_analyzer âœ…
- intelligence_analyzer
```

### æ™ºèƒ½ä½“é…ç½®
```toml
[agent.map_analysis_agent_config]
model_id = "claude37-sonnet-thinking"
name = "map_analysis_agent"
description = "åœ°å›¾åˆ†æä¸“å®¶ï¼Œè´Ÿè´£åˆ†æä½œæˆ˜åœ°åŒºåœ°å½¢åœ°è²Œï¼Œæä¾›åœ°å½¢åˆ©ç”¨å»ºè®®"
max_steps = 8
template_path = "src/agent/map_analysis_agent/prompts/map_analysis_agent.yaml"
tools = ["military_map_analyzer", "military_image_map_analyzer"]
```

### æ™ºèƒ½ä½“åˆ›å»ºéªŒè¯
```
âœ… åœ°å›¾åˆ†ææ™ºèƒ½ä½“åˆ›å»ºæˆåŠŸ
   - æ™ºèƒ½ä½“åç§°: map_analysis_agent
   - å¯ç”¨å·¥å…·æ•°é‡: 3
   - å·¥å…·åˆ—è¡¨: ['military_map_analyzer', 'military_image_map_analyzer', 'final_answer']
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨
```python
task = """
è¯·ä½¿ç”¨ military_image_map_analyzer å·¥å…·åˆ†æåœ°å½¢å›¾å›¾ç‰‡ï¼š
- å›¾ç‰‡è·¯å¾„: 'data/test_map.png'
- åˆ†æé‡ç‚¹: 'comprehensive'
- ä»»åŠ¡èƒŒæ™¯: 'offensive'
"""

result = await map_agent.run(task)
```

### å·¥å…·å‚æ•°
- `image_path` (å¿…éœ€): åœ°å½¢å›¾å›¾ç‰‡æ–‡ä»¶è·¯å¾„
- `analysis_focus` (å¯é€‰): terrain/tactical/infrastructure/comprehensive
- `mission_context` (å¯é€‰): offensive/defensive/reconnaissance/logistics
- `scale_reference` (å¯é€‰): åœ°å›¾æ¯”ä¾‹å°ºå‚è€ƒ

## ğŸ“ ç›¸å…³æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶
- `src/agent/map_analysis_agent/map_analysis_agent.py` - æ™ºèƒ½ä½“å®ç°
- `src/tools/military_image_map_analyzer.py` - å›¾ç‰‡åˆ†æå·¥å…·
- `configs/military_config.toml` - é…ç½®æ–‡ä»¶

### æç¤ºè¯å’Œæ–‡æ¡£
- `src/agent/map_analysis_agent/prompts/map_analysis_agent.yaml` - æç¤ºè¯æ¨¡æ¿
- `docs/map_analysis_agent_image_support.md` - ä½¿ç”¨æ–‡æ¡£

### æµ‹è¯•å’Œç¤ºä¾‹
- `examples/verify_map_analysis_config.py` - é…ç½®éªŒè¯è„šæœ¬
- `examples/test_map_analysis_with_image.py` - æµ‹è¯•ç¤ºä¾‹

## ğŸ‰ éªŒè¯ç»“æœ

æ‰€æœ‰éªŒè¯é¡¹ç›®å‡é€šè¿‡ï¼š
- âœ… å·¥å…·æ³¨å†Œ
- âœ… æ™ºèƒ½ä½“æ³¨å†Œ  
- âœ… é…ç½®æ–‡ä»¶
- âœ… æ™ºèƒ½ä½“åˆ›å»º
- âœ… å®é™…è¿è¡Œæµ‹è¯•

## ğŸ“Š æµ‹è¯•ç»“æœç¤ºä¾‹

æœ€æ–°çš„æµ‹è¯•è¿è¡ŒæˆåŠŸç”Ÿæˆäº†è¯¦ç»†çš„åœ°å½¢åˆ†ææŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š

### åœ°å½¢æ¦‚å†µ
- **åœ°å½¢åˆ†ç±»**: å±±åœ°
- **åœ°å½¢èµ·ä¼**: ä¸­ç­‰
- **æ¤è¢«æƒ…å†µ**: æ··åˆæ¤è¢«ï¼Œè¦†ç›–åº¦ä¸­ç­‰
- **åŸºç¡€è®¾æ–½**: è‹¥å¹²æ¡¥æ¢å’Œä¹¡æ‘é“è·¯

### å†›äº‹ä»·å€¼è¯„ä¼°
- **æ€»ä½“æˆ˜æœ¯ä»·å€¼**: ä¸­ç­‰
- **ä¼˜åŠ¿**: åœ°å½¢å¤šæ ·æ€§æä¾›äº†æˆ˜æœ¯çµæ´»æ€§
- **åŠ£åŠ¿**: å¤æ‚åœ°å½¢å¯èƒ½é™åˆ¶å¤§è§„æ¨¡è£…ç”²éƒ¨é˜ŸæœºåŠ¨

### æˆ˜æœ¯å»ºè®®
- ä¸»æ”»æ–¹å‘é€‰æ‹©å»ºè®®
- æœºåŠ¨è·¯çº¿è§„åˆ’
- ç«åŠ›é…ç½®æ–¹æ¡ˆ
- çªå‡»ç¼–ç»„å»ºè®®
- æŠ€æœ¯æ”¯æ´è¦æ±‚
- å…³é”®èŠ‚ç‚¹æ§åˆ¶ç­–ç•¥
- é£é™©è¯„ä¼°ä¸å¯¹ç­–

## ğŸ”§ è§£å†³çš„æŠ€æœ¯é—®é¢˜

1. **å¯¼å…¥é”™è¯¯ä¿®å¤**: ä¿®å¤äº† `parse_json_if_needed` å‡½æ•°çš„å¯¼å…¥è·¯å¾„
2. **æ¨¡å‹è·å–æ–¹æ³•**: ä¿®å¤äº† `ModelManager.get_model()` æ–¹æ³•è°ƒç”¨é”™è¯¯
3. **å·¥å…·æ³¨å†Œ**: ç¡®ä¿æ‰€æœ‰å·¥å…·åœ¨ä½¿ç”¨å‰æ­£ç¡®æ³¨å†Œ
4. **æ™ºèƒ½ä½“é…ç½®**: å®Œå–„äº†æ™ºèƒ½ä½“çš„å·¥å…·é…ç½®å’Œæç¤ºè¯æ¨¡æ¿

## ğŸ“ ä¸‹ä¸€æ­¥å»ºè®®

1. **å®é™…æµ‹è¯•**: ä½¿ç”¨çœŸå®çš„åœ°å½¢å›¾å›¾ç‰‡è¿›è¡Œæ›´å¤šæµ‹è¯•
2. **æ€§èƒ½ä¼˜åŒ–**: æ ¹æ®ä½¿ç”¨æƒ…å†µä¼˜åŒ–åˆ†æå‚æ•°å’Œæ¨¡å‹é€‰æ‹©
3. **åŠŸèƒ½æ‰©å±•**: å¯ä»¥è€ƒè™‘æ·»åŠ æ›´å¤šä¸“ä¸šçš„åœ°å½¢åˆ†æåŠŸèƒ½
4. **é›†æˆæµ‹è¯•**: åœ¨å®Œæ•´çš„å†›äº‹å‚è°‹ç³»ç»Ÿä¸­æµ‹è¯•é›†æˆæ•ˆæœ

---

**æ€»ç»“**: åœ°å›¾åˆ†ææ™ºèƒ½ä½“ç°åœ¨å·²ç»æˆåŠŸé›†æˆäº†å†›äº‹åœ°å½¢å›¾å›¾ç‰‡åˆ†æå·¥å…·ï¼Œå¯ä»¥å¯¹åœ°å½¢å›¾å›¾ç‰‡è¿›è¡Œä¸“ä¸šçš„å†›äº‹åœ°å½¢åˆ†æï¼Œæä¾›è¯¦ç»†çš„åˆ†ææŠ¥å‘Šå’Œæˆ˜æœ¯å»ºè®®ã€‚æ‰€æœ‰æŠ€æœ¯é—®é¢˜å·²è§£å†³ï¼ŒåŠŸèƒ½æµ‹è¯•å®Œå…¨é€šè¿‡ã€‚ 