# 军事参谋智能体Web应用使用指南

## 📋 概述

`military_web_app_simple.py` 是一个基于Gradio的Web界面，为军事参谋智能体系统提供了直观的用户交互界面。该应用支持实时进度显示，让用户可以清楚地看到智能体系统的工作进展。

## ✨ 主要功能

### 🔧 **实时进度监控**
- ✅ **智能体步骤跟踪**: 实时显示智能体执行的每个步骤
- ✅ **进度回调机制**: 通过回调函数捕获智能体内部状态
- ✅ **时间戳日志**: 每个进度都有精确的时间记录

### 📊 **流式输出显示**
- ✅ **异步生成器**: 使用Python异步生成器实现流式更新
- ✅ **非阻塞UI**: 界面保持响应，用户可以随时查看进度
- ✅ **自动初始化**: 智能体未初始化时自动进行初始化

### 🎖️ **军事专业功能**
- ✅ **地形图上传**: 支持PNG/JPG格式的地形图上传
- ✅ **任务模板**: 提供三种预设军事任务模板
- ✅ **专业术语**: 使用军事专业术语和图标

## 🚀 **快速开始**

### 1. 环境准备

确保已经安装所有依赖：
```bash
# 安装项目依赖
make install

# 或者使用pip
pip install -r requirements.txt
```

### 2. 配置文件

确保存在 `configs/military_config.toml` 配置文件，并正确配置API密钥。

### 3. 启动应用

```bash
cd examples
python military_web_app_simple.py
```

### 4. 访问界面

应用启动后会自动打开浏览器，访问地址：`http://localhost:7860`

## 📖 **使用步骤**

### 步骤1: 初始化系统
- 首次使用时点击 **"🚀 初始化系统"** 按钮
- 等待系统加载模型和智能体
- 看到 **"✅ 军事参谋系统初始化成功"** 即可使用

### 步骤2: 输入军事任务
有三种方式输入任务：

**方式1: 手动输入**
在任务描述框中详细描述军事任务，包括：
- 任务背景和目标
- 地形情况说明
- 我方兵力配置
- 敌方情况分析
- 特殊要求或限制

**方式2: 使用预设模板**
点击快速开始示例按钮：
- **山地防御作战**: 山地地形的防御任务
- **城市攻坚作战**: 城市环境的攻击任务
- **海岸登陆作战**: 两栖登陆作战任务

**方式3: 上传地形图**
可选择上传地形图文件，系统会自动分析地形信息。

### 步骤3: 开始分析
- 点击 **"🎯 开始分析"** 按钮
- 观察实时分析日志，了解处理进度
- 等待军事方案生成完成

### 步骤4: 查看结果
分析完成后，在 **"军事部署方案"** 区域查看详细的作战计划。

## 🔍 **进度显示示例**

分析过程中你会看到类似这样的实时进度：

```
[10:30:15] 🚀 开始军事任务分析
[10:30:16] 🧠 军事参谋长开始分析任务
[10:30:17] 👥 正在协调各专业军事智能体...
[10:30:20] 🔍 正在分析任务需求...
[10:30:22] 📋 制定初步作战计划...
[10:30:25] 👥 协调情报分析专家...
[10:30:28] ⚔️ 咨询作战规划专家...
[10:30:32] 🗺️ 进行地形分析评估...
[10:30:35] 📦 规划后勤保障方案...
[10:30:38] 🔄 整合各专家建议...
[10:30:42] ✏️ 生成最终作战方案...
[10:30:45] 🎯 军事方案制定完成！
```

## 🛠️ **技术实现**

### 异步生成器架构
- 使用 `async def` 和 `yield` 实现流式输出
- 遵循Python 3 asyncio规范
- 正确处理异步生成器的结束（不使用return返回值）

### 智能体回调机制
- 利用 `AsyncMultiStepAgent` 的 `step_callbacks` 功能
- 实时捕获智能体执行步骤
- 通过队列机制传递进度信息

### 错误处理
- 自动初始化未初始化的智能体
- 优雅处理网络和API错误
- 详细的错误日志和用户提示

## ⚠️ **注意事项**

1. **网络连接**: 需要稳定的网络连接访问AI模型API
2. **处理时间**: 复杂任务可能需要1-3分钟处理时间
3. **API配额**: 注意API使用配额限制
4. **资源占用**: 运行期间会占用一定的内存和CPU资源

## 🐛 **故障排除**

### 常见问题

**问题1: 系统初始化失败**
```
❌ 系统初始化失败: 配置文件不存在
```
**解决方案**: 确保 `configs/military_config.toml` 文件存在并正确配置

**问题2: API密钥错误**
```
❌ API调用失败: 无效的密钥
```
**解决方案**: 检查 `.env` 文件中的API密钥配置

**问题3: 智能体未响应**
```
⚠️ 智能体长时间无响应
```
**解决方案**: 检查网络连接和API服务状态

### 调试模式

启动时加上调试参数：
```bash
python military_web_app_simple.py --debug
```

## 📝 **更新日志**

### v1.0.0 (2024-12-xx)
- ✅ 修复异步生成器语法错误
- ✅ 实现实时进度显示
- ✅ 添加自动初始化功能
- ✅ 优化用户界面和错误处理

## 🤝 **贡献指南**

欢迎提交改进建议和错误报告！

1. Fork 项目仓库
2. 创建功能分支
3. 提交代码更改
4. 创建 Pull Request

## 📄 **许可证**

本项目遵循项目根目录下的 LICENSE 文件中指定的许可证。 